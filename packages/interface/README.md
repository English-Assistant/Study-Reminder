# 后端 API 接口说明

本文档列出了后端应用提供的主要模块及其 API 接口和作用。

## 认证模块 (`/auth`)

管理用户认证和基本设置。

- **`POST /auth/login-or-register`**
  - 作用：用户使用用户名、密码和邮箱（注册新用户时必填，已注册用户登录时可选）进行登录或注册。新用户注册时会自动创建一套默认的复习规则。
  - 成功响应：返回 JWT (access_token) 和用户信息（不含密码）。
- **`GET /auth/settings`** (需认证)
  - 作用：获取当前登录用户的通知偏好设置（如是否开启邮件通知等）。
- **`PATCH /auth/settings`** (需认证)
  - 作用：更新当前登录用户的通知偏好设置。

## 课程模块 (`/courses`)

管理用户的课程信息。所有接口均需认证。

- **`POST /courses`**
  - 作用：为当前用户创建一个新课程。
- **`GET /courses`**
  - 作用：获取当前用户的所有课程列表。
- **`GET /courses/:id`**
  - 作用：获取指定 ID 的课程详情。如果课程不存在，可能返回 null 或 404。
- **`PATCH /courses/:id`**
  - 作用：更新指定 ID 的课程信息。
- **`DELETE /courses/:id`**
  - 作用：删除指定 ID 的课程。

## 复习设置模块 (`/review-settings`)

管理用户的复习规则。所有接口均需认证。

- **`GET /review-settings`**
  - 作用：获取当前用户的所有复习规则列表。
- **`POST /review-settings/set`**
  - 作用：批量设置当前用户的复习规则列表。此操作会替换该用户所有的现有规则。

## 学习记录模块 (`/study-records`)

管理用户的学习打卡记录。所有接口均需认证。

- **`POST /study-records`**
  - 作用：为当前用户创建一条新的学习打卡记录。
- **`GET /study-records`**
  - 作用：获取当前用户的学习打卡记录列表。支持通过以下参数进行筛选：
    - `courseId` (可选): 按课程 ID 筛选。
    - `filterDate` (可选): 按打卡日期筛选 (格式 YYYY-MM-DD)。
    - `addedWithinDays` (可选): 筛选过去 N 天内添加的记录 (例如 `addedWithinDays=7`)。
- **`GET /study-records/consecutive-days`** (需认证)
  - 作用：获取当前用户从今天起向前计算的连续打卡天数。
  - 成功响应：返回一个包含 `days` 字段的对象，例如 `{ "days": 5 }`。
- **`GET /study-records/:id`**
  - 作用：获取指定 ID 的学习打卡记录详情。
- **`PATCH /study-records/:id`**
  - 作用：更新指定 ID 的学习打卡记录信息。
- **`DELETE /study-records/:id`**
  - 作用：删除指定 ID 的学习打卡记录。

## 计划复习模块 (`/upcoming-reviews`)

查询未来计划中的复习项。所有接口均需认证。

- **`GET /upcoming-reviews`**
  - 作用：获取当前用户在未来指定天数内需要复习的学习记录及其对应的复习规则和预计复习时间。
  - 查询参数：`withinDays` (可选, 数字, 默认为 7): 查询未来多少天内的复习项。

## 通知模块 (后台服务)

- 作用：此模块主要包含后台服务逻辑：
  1. **定时任务服务**: 定期检查用户的学习记录和复习规则，当达到预定复习时间时，通过邮件和应用内通知发送提醒。
  2. **WebSocket 网关**: 用于向连接的客户端实时推送应用内通知（如复习提醒）。
- 注意：客户端通常不需要直接调用此模块的 HTTP 接口（如果存在）。
